

<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to get best performance on DeepSeek-R1 in TensorRT LLM &#8212; TensorRT LLM</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/nvidia-sphinx-theme.css?v=df3ac72c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=19d20f17" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=65e89d2a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blogs/Best_perf_practice_on_DeepSeek-R1_in_TensorRT-LLM';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = './_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.2.0rc0.post1';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="H200 achieves nearly 12,000 tokens/sec on Llama2-13B with TensorRT LLM" href="H200launch.html" />
    <link rel="prev" title="Running a High Performance GPT-OSS-120B Inference Server with TensorRT LLM" href="tech_blog/blog9_Deploying_GPT_OSS_on_TRTLLM.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.2.0rc0.post1" />


  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="TensorRT LLM - Home"/>
    <img src="../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="TensorRT LLM - Home"/>
  
  
    <p class="title logo__title">TensorRT LLM</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">


<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        



  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="TensorRT LLM - Home"/>
    <img src="../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="TensorRT LLM - Home"/>
  
  
    <p class="title logo__title">TensorRT LLM</p>
  
</a>


  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">


<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">



<nav class="bd-docs-nav bd-links"
     aria-label="Table of Contents">
  <p class="bd-links__title" role="heading" aria-level="1">Table of Contents</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start-guide.html">Quick Start Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../installation/index.html">Installation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/containers.html">Pre-built release container images on NGC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/linux.html">Installing on Linux via <code class="docutils literal notranslate"><span class="pre">pip</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/build-from-source-linux.html">Building from Source Code on Linux</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deployment Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/llm_api_examples.html">LLM Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_inference.html">Generate text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_inference_async.html">Generate text asynchronously</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_inference_async_streaming.html">Generate text in streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_inference_distributed.html">Distributed LLM Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_guided_decoding.html">Generate text with guided decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_logits_processor.html">Control generated text using logits processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_multilora.html">Generate text with multiple LoRA adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_speculative_decoding.html">Speculative Decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_kv_cache_connector.html">KV Cache Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_kv_cache_offloading.html">KV Cache Offloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_runtime.html">Runtime Configuration Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_sampling.html">Sampling Techniques Showcase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_mgmn_llm_distributed.html">Run LLM-API with pytorch backend on Slurm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_mgmn_trtllm_bench.html">Run trtllm-bench with pytorch backend on Slurm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/llm_mgmn_trtllm_serve.html">Run trtllm-serve with pytorch backend on Slurm</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/trtllm_serve_examples.html">Online Serving Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/curl_chat_client.html">Curl Chat Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/curl_chat_client_for_multimodal.html">Curl Chat Client For Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/curl_completion_client.html">Curl Completion Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/deepseek_r1_reasoning_parser.html">Deepseek R1 Reasoning Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/genai_perf_client.html">Genai Perf Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/genai_perf_client_for_multimodal.html">Genai Perf Client For Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai_chat_client.html">OpenAI Chat Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai_chat_client_for_multimodal.html">OpenAI Chat Client for Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai_completion_client.html">OpenAI Completion Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai_completion_client_for_lora.html">Openai Completion Client For Lora</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/openai_completion_client_json_schema.html">OpenAI Completion Client with JSON Schema</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/dynamo_k8s_example.html">Dynamo K8s Example</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../deployment-guide/index.html">Model Recipes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../deployment-guide/quick-start-recipe-for-deepseek-r1-on-trtllm.html">Quick Start Recipe for DeepSeek R1 on TensorRT LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment-guide/quick-start-recipe-for-llama3.3-70b-on-trtllm.html">Quick Start Recipe for Llama3.3 70B on TensorRT LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment-guide/quick-start-recipe-for-llama4-scout-on-trtllm.html">Quick Start Recipe for Llama4 Scout 17B on TensorRT LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment-guide/quick-start-recipe-for-gpt-oss-on-trtllm.html">Quick Start Recipe for GPT-OSS on TensorRT-LLM - Blackwell Hardware</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../models/supported-models.html">Supported Models</a></li>

<li class="toctree-l1"><a class="reference internal" href="../models/adding-new-model.html">Adding a New Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">CLI Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../commands/trtllm-bench.html">trtllm-bench</a></li>

<li class="toctree-l1"><a class="reference internal" href="../commands/trtllm-eval.html">trtllm-eval</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../commands/trtllm-serve/index.html">trtllm-serve</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands/trtllm-serve/trtllm-serve.html">trtllm-serve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/trtllm-serve/run-benchmark-with-trtllm-serve.html">Run benchmarking with <code class="docutils literal notranslate"><span class="pre">trtllm-serve</span></code></a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../llm-api/index.html">LLM API Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../llm-api/reference.html">API Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../features/feature-combination-matrix.html">Feature Combination Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/attention.html">Multi-Head, Multi-Query, and Group-Query Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/disagg-serving.html">Disaggregated Serving (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/kvcache.html">KV Cache System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/long-sequence.html">Long Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/lora.html">LoRA (Low-Rank Adaptation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/multi-modality.html">Multimodal Support in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/overlap-scheduler.html">Overlap Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/paged-attention-ifb-scheduler.html">Paged Attention, IFB, and Request Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/parallel-strategy.html">Parallelism in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/sampling.html">Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/speculative-decoding.html">Speculative Decoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/checkpoint-loading.html">Checkpoint Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/auto_deploy/auto-deploy.html">AutoDeploy (Prototype)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/perf-analysis.html">Performance Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/perf-benchmarking.html">TensorRT LLM Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/ci-overview.html">Continuous Integration Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/dev-containers.html">Using Dev Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/api-change.html">LLM API Change Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Blogs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog10_ADP_Balance_Strategy.html">ADP Balance Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog11_GPT_OSS_Eagle3.html">Running GPT-OSS-120B with Eagle3 Speculative Decoding on GB200/B200 (TensorRT LLM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog12_Combining_Guided_Decoding_and_Speculative_Decoding.html">Combining Guided Decoding and Speculative Decoding: Making CPU and GPU Cooperate Seamlessly</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog13_Inference_Time_Compute_Implementation_in_TensorRT-LLM.html">Inference Time Compute Implementation in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog1_Pushing_Latency_Boundaries_Optimizing_DeepSeek-R1_Performance_on_NVIDIA_B200_GPUs.html">Pushing Latency Boundaries: Optimizing DeepSeek-R1 Performance on NVIDIA B200 GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog2_DeepSeek_R1_MTP_Implementation_and_Optimization.html">DeepSeek R1 MTP Implementation and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog3_Optimizing_DeepSeek_R1_Throughput_on_NVIDIA_Blackwell_GPUs.html">Optimizing DeepSeek R1 Throughput on NVIDIA Blackwell GPUs: A Deep Dive for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog4_Scaling_Expert_Parallelism_in_TensorRT-LLM.html">Scaling Expert Parallelism in TensorRT LLM (Part 1: Design and Implementation of Large-scale EP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog5_Disaggregated_Serving_in_TensorRT-LLM.html">Disaggregated Serving in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog6_Llama4_maverick_eagle_guide.html">How to launch Llama4 Maverick + Eagle3 TensorRT LLM server</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog7_NGram_performance_Analysis_And_Auto_Enablement.html">N-Gram Speculative Decoding in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog8_Scaling_Expert_Parallelism_in_TensorRT-LLM_part2.html">Scaling Expert Parallelism in TensorRT LLM (Part 2: Performance Status and Optimization)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_blog/blog9_Deploying_GPT_OSS_on_TRTLLM.html">Running a High Performance GPT-OSS-120B Inference Server with TensorRT LLM</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How to get best performance on DeepSeek-R1 in TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="H200launch.html">H200 achieves nearly 12,000 tokens/sec on Llama2-13B with TensorRT LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="XQA-kernel.html">New XQA-kernel provides 2.4x more Llama-70B throughput within the same latency budget</a></li>
<li class="toctree-l1"><a class="reference internal" href="H100vsA100.html">H100 has 4.6x A100 Performance in TensorRT LLM, achieving 10,000 tok/s at 100ms to first token</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quick Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/NVIDIA/TensorRT-LLM/releases">Releases</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NVIDIA/TensorRT-LLM">Github Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NVIDIA/TensorRT-LLM/issues?q=is%3Aissue%20state%3Aopen%20label%3Aroadmap">Roadmap</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Use TensorRT Engine</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../legacy/tensorrt_quickstart.html">LLM API with TensorRT Engine</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>



      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to get best performance on DeepSeek-R1 in TensorRT LLM</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-get-best-performance-on-deepseek-r1-in-tensorrt-llm">
<h1>How to get best performance on DeepSeek-R1 in TensorRT LLM<a class="headerlink" href="#how-to-get-best-performance-on-deepseek-r1-in-tensorrt-llm" title="Link to this heading">#</a></h1>
<p>NVIDIA has announced world-record DeepSeek-R1 inference performance at NVIDIA GTC 2025. A single NVIDIA DGX system with eight NVIDIA Blackwell GPUs can achieve over 250 tokens per second per user or a maximum throughput of over 30,000 tokens per second on the massive, state-of-the-art 671 billion parameter DeepSeek-R1 model. <a class="reference external" href="https://developer.nvidia.com/blog/nvidia-blackwell-delivers-world-record-deepseek-r1-inference-performance/">NVIDIA Blackwell Delivers World-Record DeepSeek-R1 Inference Performance</a></p>
<p>In this blog, we share the configurations and procedures about how to reproduce the number on both B200 and H200 with PyTorch workflow.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-get-best-performance-on-deepseek-r1-in-tensorrt-llm">How to get best performance on DeepSeek-R1 in TensorRT LLM</a></p>
<ul>
<li><p><a class="reference internal" href="#table-of-contents">Table of Contents</a></p></li>
<li><p><a class="reference internal" href="#prerequisites-install-tensorrt-llm-and-download-models">Prerequisites: Install TensorRT LLM and download models</a></p>
<ul>
<li><p><a class="reference internal" href="#download-tensorrt-llm">1. Download TensorRT LLM</a></p></li>
<li><p><a class="reference internal" href="#download-the-deepseek-r1-models">2. Download the DeepSeek R1 models</a></p></li>
<li><p><a class="reference internal" href="#build-and-run-tensorrt-llm-container">3. Build and run TensorRT LLM container</a></p></li>
<li><p><a class="reference internal" href="#compile-and-install-tensorrt-llm">4. Compile and Install TensorRT LLM</a></p></li>
<li><p><a class="reference internal" href="#optional-tune-gpu-clocks">5. Optional: Tune GPU clocks</a></p></li>
<li><p><a class="reference internal" href="#dataset-preparation">6. Dataset preparation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reproducing-steps">Reproducing steps</a></p>
<ul>
<li><p><a class="reference internal" href="#b200-min-latency">B200 min-latency</a></p>
<ul>
<li><p><a class="reference internal" href="#expected-results">Expected Results</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#b200-max-throughput-for-r1-0528-with-fp8-kv-cache">B200 max-throughput for R1-0528 with FP8 KV cache</a></p>
<ul>
<li><p><a class="reference internal" href="#benchmark">Benchmark</a></p></li>
<li><p><a class="reference internal" href="#expected-result-format">Expected Result Format</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#b200-max-throughput-for-r1-with-fp16-kv-cache">B200 max-throughput for R1 with FP16 KV cache</a></p>
<ul>
<li><p><a class="reference internal" href="#id1">Benchmark</a></p></li>
<li><p><a class="reference internal" href="#id2">Expected Result Format</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#h200-min-latency">H200 min-latency</a></p>
<ul>
<li><p><a class="reference internal" href="#expected-result-format-2"><span class="xref myst">Expected Result Format</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#h200-max-throughput">H200 max-throughput</a></p>
<ul>
<li><p><a class="reference internal" href="#expected-result-format-3"><span class="xref myst">Expected Result Format</span></a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#exploring-more-isl-osl-combinations">Exploring more ISL/OSL combinations</a></p>
<ul>
<li><p><a class="reference internal" href="#wip-enable-more-features-by-default">WIP: Enable more features by default</a></p></li>
<li><p><a class="reference internal" href="#not-supported-mla-chunked-context-support-on-hopper"><span class="xref myst">Not supported: MLA chunked context support on Hopper</span></a></p></li>
<li><p><a class="reference internal" href="#out-of-memory-issues">Out of memory issues</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="prerequisites-install-tensorrt-llm-and-download-models">
<h2>Prerequisites: Install TensorRT LLM and download models<a class="headerlink" href="#prerequisites-install-tensorrt-llm-and-download-models" title="Link to this heading">#</a></h2>
<p>This section can be skipped if you already have TensorRT LLM installed and have already downloaded the DeepSeek R1 model checkpoint.</p>
<section id="download-tensorrt-llm">
<h3>1. Download TensorRT LLM<a class="headerlink" href="#download-tensorrt-llm" title="Link to this heading">#</a></h3>
<p><strong>You can also find more comprehensive instructions to install TensorRT LLM in this <a class="reference external" href="https://nvidia.github.io/TensorRT-LLM/installation/build-from-source-linux.html">TensorRT LLM installation guide</a>, refer to that guide for common issues if you encounter any here.</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prerequisites</span>
apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>git-lfs
git<span class="w"> </span>lfs<span class="w"> </span>install

<span class="c1"># Replace with your actual path</span>
<span class="nv">YOUR_WORK_PATH</span><span class="o">=</span>&lt;YOUR_WORK_PATH&gt;

<span class="c1"># Clone the TensorRT LLM repository</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$YOUR_WORK_PATH</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/NVIDIA/TensorRT-LLM.git
<span class="nb">cd</span><span class="w"> </span>TensorRT-LLM
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive
git<span class="w"> </span>lfs<span class="w"> </span>pull
</pre></div>
</div>
<p><strong>Note</strong>: Replace <code class="docutils literal notranslate"><span class="pre">&lt;*_PATH&gt;</span></code> to your actual path.</p>
</section>
<section id="download-the-deepseek-r1-models">
<h3>2. Download the DeepSeek R1 models<a class="headerlink" href="#download-the-deepseek-r1-models" title="Link to this heading">#</a></h3>
<p>For NVIDIA Blackwell GPUs, it’s recommended to use the <a class="reference external" href="https://huggingface.co/nvidia/DeepSeek-R1-FP4">FP4 quantized version of DeepSeek R1</a> to get the best performance.
For NVIDIA Hopper GPUs, it’s recommended to use the FP8 version of the DeepSeek R1 model.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace with your actual path</span>
<span class="nv">YOUR_MODEL_PATH</span><span class="o">=</span>&lt;YOUR_MODEL_PATH&gt;
<span class="nb">cd</span><span class="w"> </span><span class="nv">$YOUR_MODEL_PATH</span>

<span class="c1">## Download FP4 model for Blackwell GPUs</span>
git<span class="w"> </span>clone<span class="w"> </span>https://huggingface.co/nvidia/DeepSeek-R1-FP4

<span class="c1">## Download FP8 model for Hopper GPUs</span>
<span class="c1">## FP8 model also works for Blackwell, but FP4 has the best performance on Blackwell.</span>
git<span class="w"> </span>clone<span class="w"> </span>https://huggingface.co/deepseek-ai/DeepSeek-R1
</pre></div>
</div>
</section>
<section id="build-and-run-tensorrt-llm-container">
<h3>3. Build and run TensorRT LLM container<a class="headerlink" href="#build-and-run-tensorrt-llm-container" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>TensorRT-LLM
make<span class="w"> </span>-C<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span><span class="nv">LOCAL_USER</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">DOCKER_RUN_ARGS</span><span class="o">=</span><span class="s2">&quot;-v </span><span class="nv">$YOUR_MODEL_PATH</span><span class="s2">:</span><span class="nv">$YOUR_MODEL_PATH</span><span class="s2">:ro -v </span><span class="nv">$YOUR_WORK_PATH</span><span class="s2">:</span><span class="nv">$YOUR_WORK_PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Here we set <code class="docutils literal notranslate"><span class="pre">LOCAL_USER=1</span></code> argument to set up the local user instead of root account inside the container, you can remove it if running as root inside container is fine.</p>
</section>
<section id="compile-and-install-tensorrt-llm">
<h3>4. Compile and Install TensorRT LLM<a class="headerlink" href="#compile-and-install-tensorrt-llm" title="Link to this heading">#</a></h3>
<p>Here we compile the source inside the container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>./scripts/build_wheel.py<span class="w"> </span>--trt_root<span class="w"> </span>/usr/local/tensorrt<span class="w"> </span>--benchmarks<span class="w"> </span>--cuda_architectures<span class="w"> </span><span class="s2">&quot;90-real;100-real&quot;</span><span class="w">  </span>--python_bindings<span class="w"> </span>--clean
</pre></div>
</div>
<p>You can set the cuda_architectures to “100-real” if targeting Blackwell only, and “90-real” to target Hopper only to save some build time.</p>
<p>Install and set environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>build/tensorrt_llm*.whl
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.local/bin:<span class="si">${</span><span class="nv">PATH</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</pre></div>
</div>
</section>
<section id="optional-tune-gpu-clocks">
<h3>5. Optional: Tune GPU clocks<a class="headerlink" href="#optional-tune-gpu-clocks" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span> <span class="o">-</span><span class="n">pm</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sudo</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span> <span class="o">-</span><span class="n">pm</span> <span class="mi">1</span><span class="p">;</span> <span class="n">sudo</span> <span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span> <span class="n">boost</span><span class="o">-</span><span class="n">slider</span> <span class="o">--</span><span class="n">vboost</span> <span class="mi">4</span>
</pre></div>
</div>
<p>The boost-slider option will tune the GPU clock and can get you slight perf increase, for B200 min-latency scenarios it’s about 8 TPS/USER.
This is not a required step, it’s provided here to make sure the perf numbers in this doc can be reproduced more closely to our internal run.</p>
</section>
<section id="dataset-preparation">
<h3>6. Dataset preparation<a class="headerlink" href="#dataset-preparation" title="Link to this heading">#</a></h3>
<p>The trtllm-bench tool requires a dataset file to read prompts and output sequence length of each prompt. Format details of this dataset file can be seen in <a class="reference external" href="https://nvidia.github.io/TensorRT-LLM/performance/perf-benchmarking.html#preparing-a-dataset">preparing a dataset</a>.</p>
<p>For min-latency benchmarking, <strong>real dataset is required</strong> since the MTP accept rate is affected by the dataset thus affecting the performance. You can use your own dataset following the format described in the link above.</p>
<p>For the max-throughput benchmarking, synthetic dataset is enough to be representative, since it does not use MTP.
The command to generate synthetic dataset will be attached to the max throughput section.</p>
</section>
</section>
<section id="reproducing-steps">
<h2>Reproducing steps<a class="headerlink" href="#reproducing-steps" title="Link to this heading">#</a></h2>
<p>This section provides the reproducing steps for NVIDIA Blackwell B200 and H200 GPUs, for both min-latency and max-throughput scenarios.</p>
<p>All the benchmarking is done by the trtllm-bench command line tool provided in the TensorRT LLM installation, see <a class="reference external" href="https://nvidia.github.io/TensorRT-LLM/performance/perf-benchmarking.html">TensorRT LLM Benchmarking</a> for details of this tool.</p>
<p>For brevity, we only provide the commands to reproduce the perf numbers without detailed explanation of the tools and options in this doc.</p>
<p>All these commands here are assumed to be running inside the container started by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-C</span> <span class="pre">docker</span> <span class="pre">run</span> <span class="pre">...</span></code> command mentioned in the <a class="reference internal" href="#build-and-run-tensorrt-llm-container">Build and run TensorRT LLM container section</a></p>
<section id="b200-min-latency">
<h3>B200 min-latency<a class="headerlink" href="#b200-min-latency" title="Link to this heading">#</a></h3>
<p>Our benchmark results are based on <strong>Batch = 1, ISL = 1K, OSL = 2K, num_requests = 10 from real dataset</strong></p>
<p>To do the benchmark, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DATA_PATH</span><span class="o">=</span>&lt;your<span class="w"> </span>dataset<span class="w"> </span>file<span class="w"> </span>following<span class="w"> </span>the<span class="w"> </span>format&gt;

cat<span class="w"> </span>&gt;./extra-llm-api-config.yml<span class="s">&lt;&lt;EOF</span>
<span class="s">moe_config:</span>
<span class="s">  backend: TRTLLM</span>
<span class="s">speculative_config:</span>
<span class="s">    decoding_type: MTP</span>
<span class="s">    num_nextn_predict_layers: 3</span>
<span class="s">EOF</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">TRTLLM_ENABLE_PDL</span><span class="o">=</span><span class="m">1</span>

trtllm-bench<span class="w"> </span>--model<span class="w"> </span>nvidia/DeepSeek-R1-FP4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>throughput<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dataset<span class="w"> </span><span class="nv">$YOUR_DATA_PATH</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_requests<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--concurrency<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_batch_size<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tp<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ep<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--extra_llm_api_options<span class="w"> </span>./extra-llm-api-config.yml
</pre></div>
</div>
<p>Explanation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trtllm-bench</span></code>: A CLI benchmarking utility that aims to make it easier for users to reproduce our officially published. See <a class="reference external" href="https://nvidia.github.io/TensorRT-LLM/performance/perf-benchmarking.html">TensorRT LLM Benchmarking</a> for details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--dataset</span></code>: Prompt dataset used to benchmark. Our official benchmark dataset has ISL = 1K, OSL = 2K</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--num_requests</span></code>: Num requests used for the benchmark.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--concurrency</span></code>: Total concurrency for the system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--max_batch_size</span></code>: Max batch size in each rank.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--tp</span></code>: Tensor parallel size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ep</span></code>: Expert parallel size.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--extra_llm_api_options</span></code>: Used to specify some extra config. The content of the file is as follows:</p></li>
</ul>
<section id="expected-results">
<h4>Expected Results<a class="headerlink" href="#expected-results" title="Link to this heading">#</a></h4>
<p>The perf can be different when using different datasets and different machines.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===========================================================</span>
<span class="o">=</span> <span class="n">PERFORMANCE</span> <span class="n">OVERVIEW</span>
<span class="o">===========================================================</span>
<span class="n">Request</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">req</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>                     <span class="mf">0.1341</span>
<span class="n">Total</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>             <span class="mf">274.4168</span>
<span class="n">Per</span> <span class="n">User</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">user</span><span class="p">):</span>     <span class="mf">274.7188</span>
<span class="n">Per</span> <span class="n">GPU</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">gpu</span><span class="p">):</span>       <span class="mf">34.3021</span>
<span class="n">Total</span> <span class="n">Token</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>              <span class="mf">414.0461</span>
<span class="n">Total</span> <span class="n">Latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                               <span class="mf">74561.7520</span>
<span class="n">Average</span> <span class="n">request</span> <span class="n">latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                     <span class="mf">7456.1219</span>
</pre></div>
</div>
</section>
</section>
<section id="b200-max-throughput-for-r1-0528-with-fp8-kv-cache">
<h3>B200 max-throughput for R1-0528 with FP8 KV cache<a class="headerlink" href="#b200-max-throughput-for-r1-0528-with-fp8-kv-cache" title="Link to this heading">#</a></h3>
<p>Due to our evaluation found that FP8 KV cache does not introduce obvious accuracy drop compared to BF16 KV cache. See <a class="reference internal" href="tech_blog/blog3_Optimizing_DeepSeek_R1_Throughput_on_NVIDIA_Blackwell_GPUs.html#precision-strategy"><span class="std std-ref">Precision strategy</span></a>, the latest <a class="reference external" href="https://huggingface.co/nvidia/DeepSeek-R1-0528-FP4">DeepSeek-R1-0528-FP4</a> checkpoint had enabled FP8 KV cache by-default.</p>
<p>We are seeing meaningful speedup using FP8 KV cache, thus refreshing the numbers here. The results are reproduced with TensorRT LLM commit b6261862419c33d6ce2313aff1e7116067d6037d.</p>
<p>!! Note that the exact command to reproduce numbers can change as the API/options are refactored, the option and numbers here is a reference at given exact commit.</p>
<section id="benchmark">
<h4>Benchmark<a class="headerlink" href="#benchmark" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>&gt;./extra-llm-api-config.yml<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">cuda_graph_config:</span>
<span class="s">  enable_padding: true</span>
<span class="s">  batch_sizes:</span>
<span class="s">  - 896</span>
<span class="s">  - 512</span>
<span class="s">  - 256</span>
<span class="s">  - 128</span>
<span class="s">  - 64</span>
<span class="s">  - 32</span>
<span class="s">  - 16</span>
<span class="s">  - 8</span>
<span class="s">  - 4</span>
<span class="s">  - 2</span>
<span class="s">  - 1</span>
<span class="s">print_iter_log: true</span>
<span class="s">kv_cache_dtype: fp8</span>
<span class="s">enable_attention_dp: true</span>
<span class="s">EOF</span>
trtllm-bench<span class="w">  </span>--model<span class="w"> </span>nvidia/DeepSeek-R1-0528-FP4
<span class="w">     </span>throughput
<span class="w">     </span>--dataset<span class="w"> </span><span class="si">${</span><span class="nv">YOUR_DATA_PATH</span><span class="si">}</span>
<span class="w">     </span>--tp<span class="w"> </span><span class="m">8</span><span class="w">  </span>--ep<span class="w"> </span><span class="m">8</span>
<span class="w">     </span>--extra_llm_api_options<span class="w"> </span>./extra-llm-api-config.yml
<span class="w">     </span>--max_batch_size<span class="w"> </span><span class="m">896</span>
<span class="w">     </span>--max_num_tokens<span class="w"> </span><span class="m">2048</span>
<span class="w">     </span>--kv_cache_free_gpu_mem_fraction<span class="w"> </span><span class="m">0</span>.93
<span class="w">     </span>--concurrency<span class="w"> </span><span class="m">7168</span>
<span class="w">     </span>--num_requests<span class="w"> </span><span class="m">114688</span>
</pre></div>
</div>
</section>
<section id="expected-result-format">
<h4>Expected Result Format<a class="headerlink" href="#expected-result-format" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===========================================================</span>
<span class="o">=</span> <span class="n">PERFORMANCE</span> <span class="n">OVERVIEW</span>
<span class="o">===========================================================</span>
<span class="n">Request</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">req</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>                     <span class="mf">21.0675</span>
<span class="n">Total</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>             <span class="mf">43146.2042</span>
<span class="n">Total</span> <span class="n">Token</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>              <span class="mf">65100.6376</span>
<span class="n">Total</span> <span class="n">Latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                               <span class="mf">5443839.8140</span>
<span class="n">Average</span> <span class="n">request</span> <span class="n">latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                     <span class="mf">332826.9898</span>
<span class="n">Per</span> <span class="n">User</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">[</span><span class="n">w</span><span class="o">/</span> <span class="n">ctx</span><span class="p">]</span> <span class="p">(</span><span class="n">tps</span><span class="o">/</span><span class="n">user</span><span class="p">):</span>   <span class="mf">6.1806</span>
<span class="n">Per</span> <span class="n">GPU</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tps</span><span class="o">/</span><span class="n">gpu</span><span class="p">):</span>              <span class="mf">5393.2755</span>
</pre></div>
</div>
</section>
</section>
<section id="b200-max-throughput-for-r1-with-fp16-kv-cache">
<h3>B200 max-throughput for R1 with FP16 KV cache<a class="headerlink" href="#b200-max-throughput-for-r1-with-fp16-kv-cache" title="Link to this heading">#</a></h3>
<p>Our benchmark results are based on <strong>Batch = 3072, ISL = 1K, OSL = 2K, num_requests = 49152 from synthetic dataset</strong>.</p>
<p>The results are reproduced with TensorRT LLM commit b6261862419c33d6ce2313aff1e7116067d6037d.</p>
<p>!! Note that the exact command to reproduce numbers can change as the API/options are refactored, the option and numbers here is a reference at given exact commit.</p>
<section id="id1">
<h4>Benchmark<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>To do the benchmark, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate synthetic dataset</span>
python<span class="w"> </span><span class="si">${</span><span class="nv">YOUR_WORK_PATH</span><span class="si">}</span>/benchmarks/cpp/prepare_dataset.py<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--stdout<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--tokenizer<span class="w"> </span>nvidia/DeepSeek-R1-FP4<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>token-norm-dist<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--input-mean<span class="w"> </span><span class="m">1024</span><span class="w"> </span>--output-mean<span class="w"> </span><span class="m">2048</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--input-stdev<span class="w"> </span><span class="m">0</span><span class="w"> </span>--output-stdev<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--num-requests<span class="w"> </span><span class="m">49152</span><span class="w"> </span>&gt;<span class="w"> </span>dataset.txt

<span class="nv">YOUR_DATA_PATH</span><span class="o">=</span>./dataset.txt

cat<span class="w"> </span>&gt;./extra-llm-api-config.yml<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">cuda_graph_config:</span>
<span class="s">  enable_padding: true</span>
<span class="s">  batch_sizes:</span>
<span class="s">  - 1</span>
<span class="s">  - 2</span>
<span class="s">  - 4</span>
<span class="s">  - 8</span>
<span class="s">  - 16</span>
<span class="s">  - 32</span>
<span class="s">  - 64</span>
<span class="s">  - 128</span>
<span class="s">  - 256</span>
<span class="s">  - 384</span>
<span class="s">print_iter_log: ${PRINT_ITER_LOG}</span>
<span class="s">enable_attention_dp: true</span>
<span class="s">EOF</span>

trtllm-bench<span class="w"> </span>-m<span class="w"> </span>nvidia/DeepSeek-R1-FP4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>throughput<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tp<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ep<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--warmup<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dataset<span class="w"> </span><span class="si">${</span><span class="nv">YOUR_DATA_PATH</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_batch_size<span class="w"> </span><span class="m">384</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_num_tokens<span class="w"> </span><span class="m">1536</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_requests<span class="w"> </span><span class="m">49152</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--concurrency<span class="w"> </span><span class="m">3072</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--kv_cache_free_gpu_mem_fraction<span class="w"> </span><span class="m">0</span>.85<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--extra_llm_api_options<span class="w"> </span>./extra-llm-api-config.yml
</pre></div>
</div>
</section>
<section id="id2">
<h4>Expected Result Format<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>The perf might be different from different datasets and machines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===========================================================</span>
<span class="o">=</span> <span class="n">PERFORMANCE</span> <span class="n">OVERVIEW</span>
<span class="o">===========================================================</span>
<span class="n">Request</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">req</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>                     <span class="mf">17.7657</span>
<span class="n">Total</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>             <span class="mf">36384.0838</span>
<span class="n">Total</span> <span class="n">Token</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>              <span class="mf">54576.1257</span>
<span class="n">Total</span> <span class="n">Latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                               <span class="mf">2766684.9197</span>
<span class="n">Average</span> <span class="n">request</span> <span class="n">latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                     <span class="mf">172321.7206</span>
<span class="n">Per</span> <span class="n">User</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">[</span><span class="n">w</span><span class="o">/</span> <span class="n">ctx</span><span class="p">]</span> <span class="p">(</span><span class="n">tps</span><span class="o">/</span><span class="n">user</span><span class="p">):</span>   <span class="mf">11.9263</span>
<span class="n">Per</span> <span class="n">GPU</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tps</span><span class="o">/</span><span class="n">gpu</span><span class="p">):</span>              <span class="mf">4548.0105</span>
</pre></div>
</div>
</section>
</section>
<section id="h200-min-latency">
<h3>H200 min-latency<a class="headerlink" href="#h200-min-latency" title="Link to this heading">#</a></h3>
<p>Our benchmark results are based on <strong>Batch = 1, ISL = 1K, OSL = 2K, num_requests = 10 from real dataset</strong>
To do the benchmark, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DATA_PATH</span><span class="o">=</span>&lt;your<span class="w"> </span>dataset<span class="w"> </span>file<span class="w"> </span>following<span class="w"> </span>the<span class="w"> </span>format&gt;

cat<span class="w"> </span>&gt;./extra-llm-api-config.yml<span class="s">&lt;&lt;EOF</span>
<span class="s">speculative_config:</span>
<span class="s">    decoding_type: MTP</span>
<span class="s">    num_nextn_predict_layers: 3</span>
<span class="s">EOF</span>

trtllm-bench<span class="w"> </span>--model<span class="w"> </span>deepseek-ai/DeepSeek-R1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>throughput<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dataset<span class="w"> </span><span class="nv">$YOUR_DATA_PATH</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_requests<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_batch_size<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tp<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ep<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--concurrency<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--extra_llm_api_options<span class="w"> </span>./extra-llm-api-config.yml
</pre></div>
</div>
<section id="id3">
<h4>Expected Result Format<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p>The perf might be different from different datasets and machines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===========================================================</span>
<span class="o">=</span> <span class="n">PERFORMANCE</span> <span class="n">OVERVIEW</span>
<span class="o">===========================================================</span>
<span class="n">Request</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">req</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>                     <span class="mf">0.0772</span>
<span class="n">Total</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>             <span class="mf">158.0669</span>
<span class="n">Per</span> <span class="n">User</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">user</span><span class="p">):</span>     <span class="mf">158.1196</span>
<span class="n">Per</span> <span class="n">GPU</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">gpu</span><span class="p">):</span>       <span class="mf">19.7584</span>
<span class="n">Total</span> <span class="n">Latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                               <span class="mf">129498.2168</span>
<span class="n">Average</span> <span class="n">request</span> <span class="n">latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                     <span class="mf">12945.9379</span>
</pre></div>
</div>
</section>
</section>
<section id="h200-max-throughput">
<h3>H200 max-throughput<a class="headerlink" href="#h200-max-throughput" title="Link to this heading">#</a></h3>
<p>Our benchmark results are based on <strong>Batch = 1024, ISL = 1K, OSL = 2K, num_requests = 5120 from real dataset</strong>
To do the benchmark, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate synthetic dataset</span>
python<span class="w"> </span><span class="si">${</span><span class="nv">YOUR_WORK_PATH</span><span class="si">}</span>/benchmarks/cpp/prepare_dataset.py<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--stdout<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--tokenizer<span class="w"> </span>deepseek-ai/DeepSeek-R1<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>token-norm-dist<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--input-mean<span class="w"> </span><span class="m">1024</span><span class="w"> </span>--output-mean<span class="w"> </span><span class="m">2048</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--input-stdev<span class="w"> </span><span class="m">0</span><span class="w"> </span>--output-stdev<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--num-requests<span class="w"> </span><span class="m">5120</span><span class="w"> </span>&gt;<span class="w"> </span>dataset.txt
<span class="nv">YOUR_DATA_PATH</span><span class="o">=</span>./dataset.txt

cat<span class="w"> </span>&gt;./extra-llm-api-config.yml<span class="s">&lt;&lt;EOF</span>
<span class="s">cuda_graph_config:</span>
<span class="s">  batch_sizes:</span>
<span class="s">  - 128</span>
<span class="s">enable_attention_dp: true</span>
<span class="s">EOF</span>

<span class="c1"># Use NVCC for DeepGEMM JIT compilation</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TRTLLM_DG_JIT_USE_NVCC</span><span class="o">=</span><span class="m">1</span>

trtllm-bench<span class="w"> </span>-m<span class="w"> </span>deepseek-ai/DeepSeek-R1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>throughput<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tp<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--ep<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--warmup<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dataset<span class="w"> </span><span class="nv">$YOUR_DATA_PATH</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_batch_size<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_num_tokens<span class="w"> </span><span class="m">1151</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num_requests<span class="w"> </span><span class="m">5120</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--concurrency<span class="w"> </span><span class="m">1024</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--kv_cache_free_gpu_mem_fraction<span class="w"> </span><span class="m">0</span>.8<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--extra_llm_api_options<span class="w"> </span>./extra-llm-api-config.yml
</pre></div>
</div>
<section id="id4">
<h4>Expected Result Format<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<p>The perf might be different from different datasets and machines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===========================================================</span>
<span class="o">=</span> <span class="n">PERFORMANCE</span> <span class="n">OVERVIEW</span>
<span class="o">===========================================================</span>
<span class="n">Request</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">req</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>                     <span class="mf">5.6100</span>
<span class="n">Total</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>             <span class="mf">11489.2671</span>
<span class="n">Per</span> <span class="n">User</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">user</span><span class="p">):</span>     <span class="mf">11.3476</span>
<span class="n">Per</span> <span class="n">GPU</span> <span class="n">Output</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="o">/</span><span class="n">gpu</span><span class="p">):</span>       <span class="mf">1436.1584</span>
<span class="n">Total</span> <span class="n">Token</span> <span class="n">Throughput</span> <span class="p">(</span><span class="n">tokens</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>              <span class="mf">17233.9007</span>
<span class="n">Total</span> <span class="n">Latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                               <span class="mf">912656.9938</span>
<span class="n">Average</span> <span class="n">request</span> <span class="n">latency</span> <span class="p">(</span><span class="n">ms</span><span class="p">):</span>                     <span class="mf">181540.5739</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="exploring-more-isl-osl-combinations">
<h2>Exploring more ISL/OSL combinations<a class="headerlink" href="#exploring-more-isl-osl-combinations" title="Link to this heading">#</a></h2>
<p>To benchmark TensorRT LLM on DeepSeek models with more ISL/OSL combinations, you can use <code class="docutils literal notranslate"><span class="pre">prepare_dataset.py</span></code> to generate the dataset and use similar commands mentioned in the previous section. TensorRT LLM is working on enhancements that can make the benchmark process smoother.</p>
<section id="wip-enable-more-features-by-default">
<h3>WIP: Enable more features by default<a class="headerlink" href="#wip-enable-more-features-by-default" title="Link to this heading">#</a></h3>
<p>Currently, there are some features that need to be enabled through a user-defined file <code class="docutils literal notranslate"><span class="pre">extra-llm-api-config.yml</span></code>, such as CUDA graph, overlap scheduler and attention dp. We’re working on to enable those features by default, so that users can get good out-of-the-box performance on DeepSeek models.</p>
<p>Note that, <code class="docutils literal notranslate"><span class="pre">max_batch_size</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num_tokens</span></code> can easily affect the performance. The default values for them are already carefully designed and should deliver good performance on overall cases, however, you may still need to tune it for peak performance.</p>
<p>Generally, you should make sure that <code class="docutils literal notranslate"><span class="pre">max_batch_size</span></code> is not too low to bottleneck the throughput, and <code class="docutils literal notranslate"><span class="pre">max_num_tokens</span></code> needs to be large enough so that it covers the max input sequence length of the samples in dataset, as mentioned in below section “WIP: Chunked context support on DeepSeek models”.</p>
<p>For more details on <code class="docutils literal notranslate"><span class="pre">max_batch_size</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num_tokens</span></code>, refer to <a class="reference internal" href="#../performance/performance-tuning-guide/tuning-max-batch-size-and-max-num-tokens.md"><span class="xref myst">Tuning Max Batch Size and Max Num Tokens</span></a>.</p>
</section>
<section id="mla-chunked-context">
<h3>MLA chunked context<a class="headerlink" href="#mla-chunked-context" title="Link to this heading">#</a></h3>
<p>MLA currently supports the chunked context feature on both Hopper and Blackwell GPUs. You can use <code class="docutils literal notranslate"><span class="pre">--enable_chunked_context</span></code> to enable it. This feature is primarily designed to reduce TPOT (Time Per Output Token). The default chunk size is set to <code class="docutils literal notranslate"><span class="pre">max_num_tokens</span></code>. If you want to achieve a lower TPOT, you can appropriately reduce the chunk size. However, please note that this will also decrease overall throughput. Therefore, a trade-off needs to be considered.</p>
<p>For more details on <code class="docutils literal notranslate"><span class="pre">max_num_tokens</span></code>, refer to <a class="reference internal" href="#../performance/performance-tuning-guide/tuning-max-batch-size-and-max-num-tokens.md"><span class="xref myst">Tuning Max Batch Size and Max Num Tokens</span></a>.</p>
</section>
<section id="out-of-memory-issues">
<h3>Out of memory issues<a class="headerlink" href="#out-of-memory-issues" title="Link to this heading">#</a></h3>
<p>It’s possible seeing OOM issues on some cases. Considering reducing <code class="docutils literal notranslate"><span class="pre">kv_cache_free_gpu_mem_fraction</span></code> to a smaller value as a workaround. We’re working on the investigation and addressing the problem.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tech_blog/blog9_Deploying_GPT_OSS_on_TRTLLM.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Running a High Performance GPT-OSS-120B Inference Server with TensorRT LLM</p>
      </div>
    </a>
    <a class="right-next"
       href="H200launch.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">H200 achieves nearly 12,000 tokens/sec on Llama2-13B with TensorRT LLM</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            


              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites-install-tensorrt-llm-and-download-models">Prerequisites: Install TensorRT LLM and download models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-tensorrt-llm">1. Download TensorRT LLM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-deepseek-r1-models">2. Download the DeepSeek R1 models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#build-and-run-tensorrt-llm-container">3. Build and run TensorRT LLM container</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-and-install-tensorrt-llm">4. Compile and Install TensorRT LLM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-tune-gpu-clocks">5. Optional: Tune GPU clocks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-preparation">6. Dataset preparation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducing-steps">Reproducing steps</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b200-min-latency">B200 min-latency</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-results">Expected Results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b200-max-throughput-for-r1-0528-with-fp8-kv-cache">B200 max-throughput for R1-0528 with FP8 KV cache</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmark">Benchmark</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-result-format">Expected Result Format</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#b200-max-throughput-for-r1-with-fp16-kv-cache">B200 max-throughput for R1 with FP16 KV cache</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Benchmark</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Expected Result Format</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h200-min-latency">H200 min-latency</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Expected Result Format</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h200-max-throughput">H200 max-throughput</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Expected Result Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-more-isl-osl-combinations">Exploring more ISL/OSL combinations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wip-enable-more-features-by-default">WIP: Enable more features by default</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mla-chunked-context">MLA chunked context</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-memory-issues">Out of memory issues</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            

          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
<a class="footer-brand logo" href="https://www.nvidia.com">
  <img src="../_static/nvidia-logo-horiz-rgb-1c-blk-for-screen.svg" class="logo__image only-light" alt="NVIDIA"/>
  <img src="../_static/nvidia-logo-horiz-rgb-1c-wht-for-screen.svg" class="logo__image only-dark" alt="NVIDIA"/>
</a></div>
      
        <div class="footer-item">

<div class="footer-links">
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/">Privacy Policy</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/">Manage My Privacy</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/preferences/start/">Do Not Sell or Share My Data</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/">Terms of Service</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/accessibility/">Accessibility</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/company-policies/">Corporate Policies</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/product-security/">Product Security</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/contact/">Contact</a>
  
  
  
</div>
</div>
      
        <div class="footer-item">




  <p class="copyright">
    
      Copyright © 2025, NVidia.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
<div class="extra_footer">
  
  <p>Last updated on October 13, 2025.</p>
  
  <p>This page is generated by TensorRT-LLM commit <a href="https://github.com/NVIDIA/TensorRT-LLM/tree/6632b40">6632b40</a>.</p>
  
</div></div>
      
    </div>
  
  
  
</div>

  </footer>
  </body>
</html>