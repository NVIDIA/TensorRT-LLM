

<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Checkpoint Loading &#8212; TensorRT-LLM</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/nvidia-sphinx-theme.css?v=df3ac72c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=95073da6" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=65e89d2a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'torch/features/checkpoint_loading';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = './_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '1.1.0rc2';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.1.0rc2" />


  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="TensorRT-LLM - Home"/>
    <img src="../../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="TensorRT-LLM - Home"/>
  
  
    <p class="title logo__title">TensorRT-LLM</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">


<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        



  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="TensorRT-LLM - Home"/>
    <img src="../../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="TensorRT-LLM - Home"/>
  
  
    <p class="title logo__title">TensorRT-LLM</p>
  
</a>


  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">


<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">



<nav class="bd-docs-nav bd-links"
     aria-label="Table of Contents">
  <p class="bd-links__title" role="heading" aria-level="1">Table of Contents</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start-guide.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../key-features.html">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../torch.html">PyTorch Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../installation/containers.html">Pre-built release container images on NGC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/linux.html">Installing on Linux via <code class="docutils literal notranslate"><span class="pre">pip</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/build-from-source-linux.html">Building from Source Code on Linux</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deployment Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../deployment-guide/quick-start-recipe-for-llama4-scout-on-trtllm.html">Quick Start Recipe for Llama4 Scout 17B on TensorRT-LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment-guide/quick-start-recipe-for-deepseek-r1-on-trtllm.html">Quick Start Recipe for DeepSeek R1 on TensorRT-LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment-guide/quick-start-recipe-for-llama3.3-70b-on-trtllm.html">Quick Start Recipe for Llama3.3 70B on TensorRT-LLM - Blackwell &amp; Hopper Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment-guide/quick-start-recipe-for-gpt-oss-on-trtllm.html">Quick Start Recipe for GPT-OSS on TensorRT-LLM - Blackwell Hardware</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">LLM API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../llm-api/index.html">LLM API Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../llm-api/reference.html">API Reference</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/index.html">LLM Examples Introduction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/customization.html">LLM Common Customizations</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/llm_api_examples.html">LLM Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_inference.html">Generate text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_inference_async.html">Generate text asynchronously</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_inference_async_streaming.html">Generate text in streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_inference_distributed.html">Distributed LLM Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_guided_decoding.html">Generate text with guided decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_logits_processor.html">Control generated text using logits processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_multilora.html">Generate text with multiple LoRA adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_speculative_decoding.html">Speculative Decoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_kv_cache_connector.html">KV Cache Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_runtime.html">Runtime Configuration Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_sampling.html">Sampling Techniques Showcase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_mgmn_llm_distributed.html">Run LLM-API with pytorch backend on Slurm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_mgmn_trtllm_bench.html">Run trtllm-bench with pytorch backend on Slurm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/llm_mgmn_trtllm_serve.html">Run trtllm-serve with pytorch backend on Slurm</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/trtllm_serve_examples.html">Online Serving Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/curl_chat_client.html">Curl Chat Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/curl_chat_client_for_multimodal.html">Curl Chat Client For Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/curl_completion_client.html">Curl Completion Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/deepseek_r1_reasoning_parser.html">Deepseek R1 Reasoning Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/genai_perf_client.html">Genai Perf Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/genai_perf_client_for_multimodal.html">Genai Perf Client For Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/openai_chat_client.html">OpenAI Chat Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/openai_chat_client_for_multimodal.html">OpenAI Chat Client for Multimodal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/openai_completion_client.html">OpenAI Completion Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/openai_completion_client_for_lora.html">Openai Completion Client For Lora</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/openai_completion_client_json_schema.html">OpenAI Completion Client with JSON Schema</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model Definition API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.functional.html">Functionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.plugin.html">Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api/tensorrt_llm.runtime.html">Runtime</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">C++ API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../_cpp_gen/executor.html">Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_cpp_gen/runtime.html">Runtime</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Command-Line Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../commands/trtllm-bench.html">trtllm-bench</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../commands/trtllm-build.html">trtllm-build</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../commands/trtllm-serve/index.html">trtllm-serve</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../commands/trtllm-serve/trtllm-serve.html">trtllm-serve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../commands/trtllm-serve/run-benchmark-with-trtllm-serve.html">Run benchmarking with <code class="docutils literal notranslate"><span class="pre">trtllm-serve</span></code></a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Architecture</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../architecture/overview.html">TensorRT-LLM Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/core-concepts.html">Model Definition</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../architecture/checkpoint.html">TensorRT-LLM Checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/workflow.html">TensorRT-LLM Build Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/add-model.html">Adding a Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../advanced/gpt-attention.html">Multi-Head, Multi-Query, and Group-Query Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/gpt-runtime.html">C++ GPT Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/executor.html">Executor API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/graph-rewriting.html">Graph Rewriting Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/lora.html">Run gpt-2b + LoRA using Executor / cpp runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/expert-parallelism.html">Expert Parallelism in TensorRT-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/kv-cache-management.html">KV Cache Management: Pools, Blocks, and Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/kv-cache-reuse.html">KV cache reuse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/speculative-decoding.html">Speculative Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/disaggregated-service.html">Disaggregated-Service (Prototype)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Performance</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../performance/perf-overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/perf-benchmarking.html">Benchmarking</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../performance/performance-tuning-guide/index.html">Performance Tuning Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/benchmarking-default-performance.html">Benchmarking Default Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/useful-build-time-flags.html">Useful Build-Time Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/tuning-max-batch-size-and-max-num-tokens.html">Tuning Max Batch Size and Max Num Tokens</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/deciding-model-sharding-strategy.html">Deciding Model Sharding Strategy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/fp8-quantization.html">FP8 Quantization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/performance-tuning-guide/useful-runtime-flags.html">Useful Runtime Options</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/perf-analysis.html">Performance Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../reference/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/support-matrix.html">Support Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/precision.html">Numerical Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/memory.html">Memory Usage of TensorRT-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/ci-overview.html">Continuous Integration Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/dev-containers.html">Using Dev Containers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Blogs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../blogs/H100vsA100.html">H100 has 4.6x A100 Performance in TensorRT-LLM, achieving 10,000 tok/s at 100ms to first token</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/H200launch.html">H200 achieves nearly 12,000 tokens/sec on Llama2-13B with TensorRT-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/Falcon180B-H200.html">Falcon-180B on a single H200 GPU with INT4 AWQ, and 6.7x faster Llama-70B over A100</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/quantization-in-TRT-LLM.html">Speed up inference with SOTA quantization techniques in TRT-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/XQA-kernel.html">New XQA-kernel provides 2.4x more Llama-70B throughput within the same latency budget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog10_ADP_Balance_Strategy.html">ADP Balance Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog1_Pushing_Latency_Boundaries_Optimizing_DeepSeek-R1_Performance_on_NVIDIA_B200_GPUs.html">Pushing Latency Boundaries: Optimizing DeepSeek-R1 Performance on NVIDIA B200 GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog2_DeepSeek_R1_MTP_Implementation_and_Optimization.html">DeepSeek R1 MTP Implementation and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog3_Optimizing_DeepSeek_R1_Throughput_on_NVIDIA_Blackwell_GPUs.html">Optimizing DeepSeek R1 Throughput on NVIDIA Blackwell GPUs: A Deep Dive for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog4_Scaling_Expert_Parallelism_in_TensorRT-LLM.html">Scaling Expert Parallelism in TensorRT-LLM (Part 1: Design and Implementation of Large-scale EP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog5_Disaggregated_Serving_in_TensorRT-LLM.html">Disaggregated Serving in TensorRT-LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog6_Llama4_maverick_eagle_guide.html">How to launch Llama4 Maverick + Eagle3 TensorRT-LLM server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog7_NGram_performance_Analysis_And_Auto_Enablement.html">N-Gram Speculative Decoding in TensorRT‑LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog8_Scaling_Expert_Parallelism_in_TensorRT-LLM_part2.html">Scaling Expert Parallelism in TensorRT-LLM (Part 2: Performance Status and Optimization)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/tech_blog/blog9_Deploying_GPT_OSS_on_TRTLLM.html">Running a High Performance GPT-OSS-120B Inference Server with TensorRT-LLM</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>



      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Checkpoint Loading</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="checkpoint-loading">
<h1>Checkpoint Loading<a class="headerlink" href="#checkpoint-loading" title="Link to this heading">#</a></h1>
<p>The PyTorch backend provides a flexible and extensible infrastructure for loading model checkpoints from different sources and formats, such as HuggingFace (HF) or custom formats, by implementing required components like the checkpoint’s weight loader, mapper, and configuration parser.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#overview">Overview</a></p></li>
<li><p><a class="reference internal" href="#core-components">Core Components</a></p></li>
<li><p><a class="reference internal" href="#built-in-checkpoint-formats">Built-in Checkpoint Formats</a></p></li>
<li><p><a class="reference internal" href="#using-checkpoint-loaders">Using Checkpoint Loaders</a></p></li>
<li><p><a class="reference internal" href="#creating-custom-checkpoint-loaders">Creating Custom Checkpoint Loaders</a></p></li>
</ol>
</section>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The checkpoint loading design is built around a plugin-like architecture that is separated into four distinct components:</p>
<ul class="simple">
<li><p><strong>Checkpoint Loaders</strong>: Orchestrates the loading process for specific formats.</p></li>
<li><p><strong>Config Loaders</strong>: Handles model configuration parsing and validation.</p></li>
<li><p><strong>Weight Loaders</strong>: Manages the actual loading of model weights from storage into memory.</p></li>
<li><p><strong>Weight Mappers</strong>: Maps and transforms loaded weights to the TRTLLM model’s definition.</p></li>
</ul>
<p>This modular design allows for easy extension to support new checkpoint formats while maintaining backward compatibility and performance optimizations. By separating checkpoint loading into four subcomponents, users can leverage existing implementations and introduce custom, checkpoint-specific components.</p>
<p>To support a new checkpoint format, you must implement all four components.
If the format shares components with an existing framework (such as HF), you only need to implement the components that differ.</p>
</section>
<section id="core-components">
<h2>Core Components<a class="headerlink" href="#core-components" title="Link to this heading">#</a></h2>
<section id="basecheckpointloader">
<h3>BaseCheckpointLoader<a class="headerlink" href="#basecheckpointloader" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">BaseCheckpointLoader</span></code> is the central interface for all checkpoint loading operations. It provides a unified API regardless of the underlying checkpoint format. This interface is responsible for holding and exposing all objects required for the loading and parsing process.</p>
<p><strong>Key Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">load_config(checkpoint_dir,</span> <span class="pre">**kwargs)</span></code>: Loads and returns a <code class="docutils literal notranslate"><span class="pre">ModelConfig</span></code> object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load_weights(checkpoint_dir,</span> <span class="pre">**kwargs)</span></code>: Loads and returns a dictionary of weights</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_initialized_weight_mapper(model,</span> <span class="pre">config)</span></code>: Returns a weight mapper initialized at runtime for the model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup()</span></code>: Releases resources and cleans up internal state</p></li>
</ul>
</section>
<section id="baseconfigloader">
<h3>BaseConfigLoader<a class="headerlink" href="#baseconfigloader" title="Link to this heading">#</a></h3>
<p>Loads model configurations from checkpoint directories and parses them into a TRTLLM <code class="docutils literal notranslate"><span class="pre">ModelConfig</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseConfigLoader</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomConfigLoader</span><span class="p">(</span><span class="n">BaseConfigLoader</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelConfig</span><span class="p">:</span>
        <span class="c1"># Load and parse configuration from your custom format</span>
        <span class="n">pretrained_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pretrained_config</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelConfig</span><span class="p">(</span><span class="n">pretrained_config</span><span class="o">=</span><span class="n">pretrained_config</span><span class="p">,</span>
                            <span class="o">...</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pretrained_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="o">...</span>

</pre></div>
</div>
</section>
<section id="baseweightloader">
<h3>BaseWeightLoader<a class="headerlink" href="#baseweightloader" title="Link to this heading">#</a></h3>
<p>Handles the loading of model weights from storage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_weight_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseWeightLoader</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomWeightLoader</span><span class="p">(</span><span class="n">BaseWeightLoader</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># Load weights from your custom format</span>
        <span class="c1"># Return a dictionary mapping parameter names to tensors</span>
        <span class="k">return</span> <span class="n">weights_dict</span>
</pre></div>
</div>
</section>
<section id="baseweightmapper">
<h3>BaseWeightMapper<a class="headerlink" href="#baseweightmapper" title="Link to this heading">#</a></h3>
<p>Transforms weights between different naming conventions and applies model-specific transformations to the TRTLLM model object.</p>
</section>
</section>
<section id="built-in-checkpoint-formats">
<h2>Built-in Checkpoint Formats<a class="headerlink" href="#built-in-checkpoint-formats" title="Link to this heading">#</a></h2>
<section id="huggingface-format">
<h3>HuggingFace Format<a class="headerlink" href="#huggingface-format" title="Link to this heading">#</a></h3>
<p>Currently, the HF checkpoint loader is the primary built-in format and supports:</p>
<ul class="simple">
<li><p><strong>Weights loading</strong> (<code class="docutils literal notranslate"><span class="pre">.safetensors,</span> <span class="pre">.bin,</span> <span class="pre">.pth</span></code>): Load HF-compatible weights from disk</p></li>
<li><p><strong>Configuration parser</strong> - Parse configuration information stored by HF into a TRTLLM <code class="docutils literal notranslate"><span class="pre">ModelConfig</span></code> object</p></li>
<li><p><strong>Weights Mapping</strong> - Convert HF weights into a TRTLLM-compatible representation</p></li>
</ul>
</section>
</section>
<section id="using-checkpoint-loaders">
<h2>Using Checkpoint Loaders<a class="headerlink" href="#using-checkpoint-loaders" title="Link to this heading">#</a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">#</a></h3>
<p>There are two main approaches for using checkpoint loading objects</p>
<p>The first approach is through the llm-api, as shown in the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLM</span>

<span class="n">hf_model_dir</span> <span class="o">=</span> <span class="s2">&quot;llama-models-v2/llama-v2-13b-hf&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">hf_model_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">HfCheckpointLoader</span></code> is selected by default.</p>
<p>To explicitly set the checkpoint loader, specify the required checkpoint-specific loader:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.hf.checkpoint_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">HfCheckpointLoader</span>

<span class="n">hf_model_dir</span> <span class="o">=</span> <span class="s2">&quot;llama-models-v2/llama-v2-13b-hf&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">hf_model_dir</span><span class="p">,</span>
          <span class="n">checkpoint_loader</span><span class="o">=</span><span class="n">HfCheckpointLoader</span><span class="p">())</span>
</pre></div>
</div>
<p>Similarly, to use a basic checkpoint loader with a specific subcomponent, provide the desired subcomponent as needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.hf.checkpoint_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">HfCheckpointLoader</span>

<span class="n">hf_model_dir</span> <span class="o">=</span> <span class="s2">&quot;llama-models-v2/llama-v2-13b-hf&quot;</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">LLM</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">hf_model_dir</span><span class="p">,</span>
          <span class="n">checkpoint_loader</span><span class="o">=</span><span class="n">HfCheckpointLoader</span><span class="p">(</span><span class="n">weight_loader</span><span class="o">=</span><span class="n">MyCustomWeightLoader</span><span class="p">()))</span>
</pre></div>
</div>
<p>In the second approach, you can directly use the individual checkpoint loading components:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.hf.gemma3_weight_mapper</span><span class="w"> </span><span class="kn">import</span> \
    <span class="n">Gemma3HfWeightMapper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.modeling_gemma3</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gemma3ForCausalLM</span>

<span class="n">gemma3</span> <span class="o">=</span> <span class="n">Gemma3ForCausalLM</span><span class="p">(</span><span class="n">model_config</span><span class="p">)</span>
<span class="n">weight_mapper</span> <span class="o">=</span> <span class="n">Gemma3HfWeightMapper</span><span class="p">()</span>
<span class="n">weight_mapper</span><span class="o">.</span><span class="n">init_model_and_config</span><span class="p">(</span><span class="n">gemma3</span><span class="p">,</span> <span class="n">model_config</span><span class="p">)</span>
<span class="n">gemma3</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="n">hf_gemma3</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">weight_mapper</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-custom-checkpoint-loaders">
<h2>Creating Custom Checkpoint Loaders<a class="headerlink" href="#creating-custom-checkpoint-loaders" title="Link to this heading">#</a></h2>
<p>To support a new checkpoint format, implement all four components. This section provides minimal templates for each.</p>
<section id="when-to-create-custom-components">
<h3>When to Create Custom Components<a class="headerlink" href="#when-to-create-custom-components" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Complete New Format</strong>: Implement all four components to support a new checkpoint format</p></li>
<li><p><strong>Custom Weight Storage</strong>: Implement only a custom weight loader if you have a unique weight storage format (such as a custom binary format or database storage)</p></li>
<li><p><strong>Custom Configuration</strong>: Implement only a custom config loader if your configuration format cannot be parsed by existing loaders</p></li>
<li><p><strong>Custom Weight Mapping</strong>: Implement only a custom weight mapper if your model has unique weight naming or transformation requirements that are checkpoint-specific</p></li>
</ul>
</section>
<section id="step-1-create-the-checkpoint-loader">
<h3>Step 1: Create the Checkpoint Loader<a class="headerlink" href="#step-1-create-the-checkpoint-loader" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_checkpoint_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseCheckpointLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseConfigLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_weight_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseWeightLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_weight_mapper</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseWeightMapper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.modeling_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_checkpoint_loader</span>

<span class="nd">@register_checkpoint_loader</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomCheckpointLoader</span><span class="p">(</span><span class="n">BaseCheckpointLoader</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="o">*</span><span class="p">,</span>
                 <span class="n">weight_loader</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseWeightLoader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">weight_mapper</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseWeightMapper</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">config_loader</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseConfigLoader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_loader</span> <span class="o">=</span> <span class="n">weight_loader</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_weight_loader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_loader</span> <span class="o">=</span> <span class="n">config_loader</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_config_loader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_mapper</span> <span class="o">=</span> <span class="n">weight_mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint_format</span> <span class="o">=</span> <span class="s2">&quot;CUSTOM_FORMAT&quot;</span> <span class="c1"># Set the checkpoint format name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_weight_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseWeightLoader</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CustomWeightLoader</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_config_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseConfigLoader</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CustomConfigLoader</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="step-2-create-the-checkpoint-weight-loader">
<h3>Step 2: Create the Checkpoint Weight Loader<a class="headerlink" href="#step-2-create-the-checkpoint-weight-loader" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_weight_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseWeightLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.modeling_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_checkpoint_weight_loader</span>

<span class="nd">@register_checkpoint_weight_loader</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomWeightLoader</span><span class="p">(</span><span class="n">BaseWeightLoader</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load weights from your custom format.</span>

<span class="sd">        Args:</span>
<span class="sd">            checkpoint_dir: Directory containing checkpoint files</span>
<span class="sd">            **kwargs: Additional loading parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping parameter names to tensors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Implement your custom weight loading logic here</span>

        <span class="c1"># Examples:</span>
        <span class="c1"># - Load from custom binary files</span>
        <span class="c1"># - Load from databases</span>
        <span class="c1"># - Load from compressed archives</span>
        <span class="c1"># - Apply custom preprocessing</span>

        <span class="k">return</span> <span class="n">weights</span>
</pre></div>
</div>
</section>
<section id="step-3-create-the-checkpoint-config-loader">
<h3>Step 3: Create the Checkpoint Config Loader<a class="headerlink" href="#step-3-create-the-checkpoint-config-loader" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.model_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_config_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseConfigLoader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.modeling_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_config_loader</span>

<span class="nd">@register_config_loader</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomConfigLoader</span><span class="p">(</span><span class="n">BaseConfigLoader</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load and parse configuration from your custom format.</span>

<span class="sd">        Args:</span>
<span class="sd">            checkpoint_dir: Directory containing configuration files</span>
<span class="sd">            **kwargs: Additional loading parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelConfig object containing parsed configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load your custom configuration format here</span>
        <span class="c1"># Examples:</span>
        <span class="c1"># - Parse YAML/TOML files</span>
        <span class="c1"># - Convert from proprietary formats</span>

        <span class="n">pretrained_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_pretrained_config</span><span class="p">(</span><span class="n">checkpoint_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelConfig</span><span class="p">(</span>
            <span class="n">pretrained_config</span><span class="o">=</span><span class="n">pretrained_config</span><span class="p">,</span>
            <span class="c1"># Add other ModelConfig parameters as needed</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_pretrained_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkpoint_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the raw configuration from your custom format.&quot;&quot;&quot;</span>
        <span class="c1"># Implement as needed</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="step-4-create-the-checkpoint-weight-mapper">
<h3>Step 4: Create the Checkpoint Weight Mapper<a class="headerlink" href="#step-4-create-the-checkpoint-weight-mapper" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.checkpoints.base_weight_mapper</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseWeightMapper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorrt_llm._torch.models.modeling_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_mapper</span>

<span class="nd">@register_mapper</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomWeightMapper</span><span class="p">(</span><span class="n">BaseWeightMapper</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Define any weight transformation callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># Add your custom weight transformation functions</span>
            <span class="c1"># self._custom_transform_function,</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">map_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define mappings between source and target weight names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="c1"># Map source names to target names</span>
            <span class="c1"># &#39;target_module_name&#39;: [&#39;source_param1&#39;, &#39;source_param2&#39;],</span>
            <span class="c1"># For example: &#39;qkv_proj&#39;: [&#39;q_proj&#39;, &#39;k_proj&#39;, &#39;v_proj&#39;]</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">module_names_breakdown</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                        <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply weight transformations for modules that require special handling.</span>

<span class="sd">        Args:</span>
<span class="sd">            module: The target module</span>
<span class="sd">            module_name: The specific module name being processed</span>
<span class="sd">            module_names_breakdown: Module path components</span>
<span class="sd">            weights: Source weights dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of transformed weight dictionaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">module_weights</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">[</span><span class="n">module_name</span><span class="p">]:</span>
            <span class="c1"># Filter weights for this specific parameter</span>
            <span class="n">fw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_weights</span><span class="p">(</span>
                <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">module_names_breakdown</span> <span class="o">+</span> <span class="p">[</span><span class="n">new_name</span><span class="p">]),</span> <span class="n">weights</span><span class="p">)</span>

            <span class="c1"># Apply transformation callbacks</span>
            <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
                <span class="n">fw</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">fw</span><span class="p">)</span>

            <span class="n">module_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">module_weights</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">should_skip_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define which modules should be skipped during loading.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add logic to skip specific modules based on your requirements</span>
        <span class="c1"># Examples:</span>
        <span class="c1"># - Skip LoRA-specific modules</span>
        <span class="c1"># - Skip temporary/auxiliary modules</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">should_skip_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: When creating a custom mapper, you can define either a checkpoint-format-specific mapper. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_mapper</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomWeightMapper</span><span class="p">(</span><span class="n">BaseWeightMapper</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can define a checkpoint-model-specific mapper. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@register_mapper</span><span class="p">(</span><span class="s2">&quot;CUSTOM_FORMAT&quot;</span><span class="p">,</span> <span class="s2">&quot;Gemma3ForCausalLM&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CustomWeightMapper</span><span class="p">(</span><span class="n">BaseWeightMapper</span><span class="p">)</span>
</pre></div>
</div>
<p>By setting the model name, the registered mapper will be associated with the specific model.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            


              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-components">Core Components</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basecheckpointloader">BaseCheckpointLoader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseconfigloader">BaseConfigLoader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseweightloader">BaseWeightLoader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baseweightmapper">BaseWeightMapper</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#built-in-checkpoint-formats">Built-in Checkpoint Formats</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#huggingface-format">HuggingFace Format</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-checkpoint-loaders">Using Checkpoint Loaders</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-usage">Basic Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-custom-checkpoint-loaders">Creating Custom Checkpoint Loaders</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-to-create-custom-components">When to Create Custom Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-create-the-checkpoint-loader">Step 1: Create the Checkpoint Loader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-create-the-checkpoint-weight-loader">Step 2: Create the Checkpoint Weight Loader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-create-the-checkpoint-config-loader">Step 3: Create the Checkpoint Config Loader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-create-the-checkpoint-weight-mapper">Step 4: Create the Checkpoint Weight Mapper</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            

          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
<a class="footer-brand logo" href="https://www.nvidia.com">
  <img src="../../_static/nvidia-logo-horiz-rgb-1c-blk-for-screen.svg" class="logo__image only-light" alt="NVIDIA"/>
  <img src="../../_static/nvidia-logo-horiz-rgb-1c-wht-for-screen.svg" class="logo__image only-dark" alt="NVIDIA"/>
</a></div>
      
        <div class="footer-item">

<div class="footer-links">
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/">Privacy Policy</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/">Manage My Privacy</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/preferences/start/">Do Not Sell or Share My Data</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/">Terms of Service</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/accessibility/">Accessibility</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/about-nvidia/company-policies/">Corporate Policies</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/product-security/">Product Security</a>
   | 
  
  
  
  <a class="external" href="https://www.nvidia.com/en-us/contact/">Contact</a>
  
  
  
</div>
</div>
      
        <div class="footer-item">




  <p class="copyright">
    
      Copyright © 2025, NVidia.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
<div class="extra_footer">
  
  <p>Last updated on August 29, 2025.</p>
  
  <p>This page is generated by TensorRT-LLM commit <a href="https://github.com/NVIDIA/TensorRT-LLM/tree/15ec2b8">15ec2b8</a>.</p>
  
</div></div>
      
    </div>
  
  
  
</div>

  </footer>
  </body>
</html>