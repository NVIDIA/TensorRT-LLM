metadata:
  model_name: kimi-k2-thinking-fp4
  precision: fp4
  model_dir_name: Kimi-K2-Thinking-NVFP4
  supported_gpus:
  - GB200
  - GB300
  script_file: disaggr_torch.slurm
  benchmark_type: 1k1k
  dataset_file: disagg_datasets/kimi-k2-1024-1024-20000-ratio-1_for_serve.json
  accuracy:
    datasets:
    - dataset_name: gpqa_diamond_local
      expected_value: 0.65
      threshold_type: hypothesis_test
      filter_type: strict-match
slurm:
  script_file: disaggr_torch.slurm
  partition: <partition>
  account: <account>
  job_time: 03:00:00
  job_name: unified-benchmark
  extra_args: "--gres=gpu:4"
  numa_bind: true
benchmark:
  enable_benchmark: false
  mode: e2e
  use_nv_sa_benchmark: false
  multi_round: 8
  benchmark_ratio: 1.0
  streaming: true
  concurrency_list: '8192'
  input_length: 1024
  output_length: 1024
  dataset_file: <dataset_file>
hardware:
  gpus_per_node: 4
  num_ctx_servers: 3
  num_gen_servers: 1
environment:
  container_mount: <container_mount>
  container_image: <container_image>
  model_path: <model_path>
  trtllm_repo: ''
  build_wheel: false
  work_dir: <full_path_to_work_dir>
profiling:
  nsys_on: false
accuracy:
  enable_accuracy_test: true
  env_var:
    HF_HOME: <hf_home_path>
  tasks:
    gpqa_diamond_local:
      model: "local-chat-completions"
      model_args_extra: "num_concurrent=512,max_retries=3,tokenized_requests=false,timeout=7200,max_gen_toks=16384"
      extra_kwargs:
        apply_chat_template: true
        trust_remote_code: true
        custom_config: <repo_path>/tests/integration/lm_eval_configs/gpqa_diamond_local.yaml
worker_config:
  gen:
    enable_layerwise_nvtx_marker: true
    tensor_parallel_size: 16
    moe_expert_parallel_size: 16
    enable_attention_dp: true
    enable_lm_head_tp_in_adp: false
    pipeline_parallel_size: 1
    max_batch_size: 512
    max_num_tokens: 512
    max_seq_len: 16384
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 512
    print_iter_log: true
    kv_cache_config:
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.85
      dtype: fp8
    moe_config:
      backend: WIDEEP
      use_low_precision_moe_combine: true
      load_balancer:
        num_slots: 384
        layer_updates_per_iter: 1
    cache_transceiver_config:
      max_tokens_in_buffer: 8448
      backend: NIXL
    stream_interval: 100
    num_postprocess_workers: 4
    trust_remote_code: true
  ctx:
    enable_layerwise_nvtx_marker: true
    max_batch_size: 32
    max_num_tokens: 8448
    max_seq_len: 8448
    tensor_parallel_size: 4
    moe_expert_parallel_size: 4
    enable_attention_dp: true
    pipeline_parallel_size: 1
    print_iter_log: true
    cuda_graph_config: null
    disable_overlap_scheduler: true
    kv_cache_config:
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.75
      dtype: fp8
    cache_transceiver_config:
      max_tokens_in_buffer: 8448
      backend: NIXL
    trust_remote_code: true
