metadata:
  model_name: gpt_oss_120b_fp4
  supported_gpus:
  - GB200
hardware:
  gpus_per_node: 4
server_configs:
  - name: "gpt_oss_fp4_dep4_1k8k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 4
    moe_expert_parallel_size: 4
    pipeline_parallel_size: 1
    max_batch_size: 640
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: true
    attention_dp_config:
      enable_balance: true
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 640
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.8
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con2560_iter5_1k8k"
        concurrency: 2560
        iterations: 5
        isl: 1024
        osl: 8192
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k8k-20480-ratio-1_for_serve.json

  - name: "gpt_oss_fp4_dep2_1k1k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 2
    moe_expert_parallel_size: 2
    pipeline_parallel_size: 1
    max_batch_size: 1024
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: true
    attention_dp_config:
      enable_balance: true
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 1024
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.8
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con2048_iter5_1k1k"
        concurrency: 2048
        iterations: 5
        isl: 1024
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k1k-20480-ratio-1_for_serve.json

  - name: "gpt_oss_fp4_tep2_1k8k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 2
    moe_expert_parallel_size: 2
    pipeline_parallel_size: 1
    max_batch_size: 128
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 128
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.8
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con128_iter10_1k8k"
        concurrency: 128
        iterations: 10
        isl: 1024
        osl: 8192
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k8k-20480-ratio-1_for_serve.json

  - name: "gpt_oss_fp4_tp2_1k8k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 2
    moe_expert_parallel_size: 1
    pipeline_parallel_size: 1
    max_batch_size: 8
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 8
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.8
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con8_iter10_1k8k"
        concurrency: 8
        iterations: 10
        isl: 1024
        osl: 8192
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k8k-20480-ratio-1_for_serve.json

  - name: "gpt_oss_fp4_tp4_eagle3_1k1k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 4
    moe_expert_parallel_size: 1
    pipeline_parallel_size: 1
    max_batch_size: 1
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 1
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.8
    speculative_config:
      decoding_type: 'Eagle'
      eagle3_layers_to_capture: [-1]
      max_draft_len: 3
      speculative_model: "gpt_oss/gpt-oss-120b-Eagle3"
    stream_interval: 20
    num_postprocess_workers: 4
    client_configs:
      - name: "con1_iter32_1k1k"
        concurrency: 1
        iterations: 32
        isl: 1024
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k1k-20480-ratio-1_for_serve.json

  # GPT-OSS configs from Excel - 1k1k TP2 (TP2EP1) con4
  - name: "gpt_oss_fp4_tp2_mtp0_1k1k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 2
    moe_expert_parallel_size: 1
    pipeline_parallel_size: 1
    max_batch_size: 512
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 512
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.85
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con4_iter10_1k1k"
        concurrency: 4
        iterations: 10
        isl: 1024
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k1k-20480-ratio-1_for_serve.json

  # GPT-OSS configs from Excel - 1k1k TP1 con256
  - name: "gpt_oss_fp4_tp1_mtp0_1k1k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 1
    moe_expert_parallel_size: 1
    pipeline_parallel_size: 1
    max_batch_size: 512
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 512
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.85
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con256_iter10_1k1k"
        concurrency: 256
        iterations: 10
        isl: 1024
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-1k1k-20480-ratio-1_for_serve.json

  # GPT-OSS configs from Excel - 8k1k TP1 con4 and con256
  - name: "gpt_oss_fp4_tp1_mtp0_8k1k"
    model_name: "gpt_oss_120b_fp4"
    tensor_parallel_size: 1
    moe_expert_parallel_size: 1
    pipeline_parallel_size: 1
    max_batch_size: 512
    max_num_tokens: 20000
    attn_backend: "TRTLLM"
    enable_attention_dp: false
    moe_config:
      backend: 'TRTLLM'
    cuda_graph_config:
      enable_padding: true
      max_batch_size: 512
    kv_cache_config:
      dtype: 'fp8'
      enable_block_reuse: false
      free_gpu_memory_fraction: 0.85
    num_postprocess_workers: 4
    stream_interval: 20
    client_configs:
      - name: "con4_iter10_8k1k"
        concurrency: 4
        iterations: 10
        isl: 8192
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-8k1k-20480-ratio-1_for_serve.json
      - name: "con256_iter10_8k1k"
        concurrency: 256
        iterations: 10
        isl: 8192
        osl: 1024
        backend: "openai"
        dataset_file: datasets/perf-ci/gpt_oss_120b-8k1k-20480-ratio-1_for_serve.json
